<div class="max-w-7xl mx-auto px-4 py-10 space-y-8">

  <!-- Toolbar --------------------------------------------------------- -->
  <div class="glass-card flex flex-wrap gap-4 items-center p-4 sm:p-5">
    <zso-input-field type="text"
                     label="Suche"
                     class="flex-grow sm:flex-none sm:w-72"
                     [(ngModel)]="search"
                     (ngModelChange)="refresh$.next()"></zso-input-field>

    <div class="ml-auto text-sm text-white/80 flex gap-3 items-center">
      <ng-container *ngIf="stats$ | async as s">
        <span>{{ s.total }} Nutzer</span>
        <span class="text-amber-300" title="Pending">• {{ s.pending }}</span>
        <span class="text-rose-400"  title="Gesperrt">• {{ s.blocked }}</span>
      </ng-container>

      <!-- Refresh-Button -->
      <zso-button type="neutral" size="sm" icon="refresh" title="Aktualisieren"
                  (click)="refresh$.next()">
      </zso-button>
    </div>
  </div>

  <!-- User-Liste ------------------------------------------------------ -->
  <div *ngIf="users$ | async as users; else loading"
       class="grid gap-4 grid-cols-[repeat(auto-fit,minmax(21rem,1fr))]">

    <div *ngIf="!users.length"
         class="col-span-full text-center text-sm text-gray-400">
      Keine passenden Benutzer gefunden.
    </div>

    <div *ngFor="let u of users"
         class="glass-card shimmer-once p-6 flex flex-col gap-4" zsoCardShimmer>

      <!-- Kopf (Name + Rolle) --------------------------------------- -->
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
        <div>
          <h2 class="text-lg font-semibold text-white">
            {{ u.firstName }} {{ u.lastName }}
            <span *ngIf="!u.approved" class="badge badge--pending">Pending</span>
            <span *ngIf="u.blocked"  class="badge badge--suspended">Gesperrt</span>
          </h2>
          <p class="text-sm text-gray-300">{{ u.email }}</p>
        </div>

        <!-- Rollenauswahl -->
        <zso-role-select [roleOptions]="['user','admin']"
                         [selected]="u.roles"
                         (selectedChange)="setRoles(u,$event)">
        </zso-role-select>
      </div>

      <!-- Aktionen ---------------------------------------------------- -->
      <div class="flex flex-row flex-wrap gap-2">

        <!-- Genehmigen -->
        <zso-button *ngIf="!u.approved"
                    type="neutral" size="xs" icon="check" title="Genehmigen"
                    (click)="approve(u)">
        </zso-button>

        <!-- Block / Entsperren -->
        <zso-button type="neutral" size="xs"
                    [icon]="u.blocked ? 'lock_open' : 'block'"
                    [title]="u.blocked ? 'Entsperren' : 'Blockieren'"
                    (click)="toggleActive(u)">
        </zso-button>

        <!-- Details -->
        <zso-button type="neutral" size="xs" icon="arrow_forward"
                    title="Details" (click)="details(u)">
        </zso-button>
      </div>
    </div>
  </div>

  <!-- Fallback -------------------------------------------------------- -->
  <ng-template #loading>
    <p class="text-center text-sm text-gray-400">Lade Benutzer…</p>
  </ng-template>

  <!-- Confirm-Dialog -------------------------------------------------- -->
  <zso-confirmation-dialog></zso-confirmation-dialog>
</div>
