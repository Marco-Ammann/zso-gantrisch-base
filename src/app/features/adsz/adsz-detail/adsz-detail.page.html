<!-- src/app/features/adsz/adsz-detail/adsz-detail.page.html -->
<div class="page-wrapper" @fadeIn>
  <!-- Loading -->
  <div *ngIf="isLoading" class="state-box">
    <span class="material-symbols-outlined animate-spin">progress_activity</span>
    <span>Person wird geladen…</span>
  </div>

  <!-- Error -->
  <div *ngIf="errorMsg && !isLoading" class="state-box text-rose-400">
    <span class="material-symbols-outlined">error</span>
    <span>{{ errorMsg }}</span>
  </div>

  <!-- Detail -->
  <ng-container *ngIf="person && !isLoading && !errorMsg">
    <div class="content max-w-6xl mx-auto space-y-8">
      <div class="main-grid md:grid md:grid-cols-3 gap-8">
        <div class="details col-span-2 space-y-8">
    <header class="detail-header flex items-center gap-6 bg-white/10 backdrop-blur rounded-lg p-6 shadow-lg">
      <div class="avatar w-24 h-24 rounded-full overflow-hidden flex items-center justify-center bg-gray-700/50" [ngClass]="{ placeholder: !person.photoUrl }">
        <img *ngIf="person.photoUrl" [src]="person.photoUrl" alt="Avatar" class="object-cover w-full h-full" />
        <span *ngIf="!person.photoUrl">{{ getPersonInitials() }}</span>
      </div>
      <div class="info">
        <h1>{{ person.grunddaten.vorname }} {{ person.grunddaten.nachname }}</h1>
        <p>{{ person.zivilschutz.einteilung.zug }}. Zug • Gruppe {{ person.zivilschutz.einteilung.gruppe }} • {{ person.grunddaten.grad }}</p>
      </div>
      <button zso-button (click)="openEdit()">Bearbeiten</button>
    </header>

    <section class="section bg-white/10 backdrop-blur rounded-lg p-6 shadow-md space-y-2">
      <h2>Grunddaten</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="field flex flex-col text-sm"><span>Vorname:</span>{{ person.grunddaten.vorname }}</div>
        <div class="field flex flex-col text-sm"><span>Nachname:</span>{{ person.grunddaten.nachname }}</div>
        <div class="field flex flex-col text-sm"><span>Geburtsdatum:</span>{{ geburtsdatumTimestamp | date:'dd.MM.yyyy' }}</div>
        <div class="field flex flex-col text-sm"><span>Grad:</span>{{ person.grunddaten.grad }}</div>
        <div class="field flex flex-col text-sm"><span>Funktion:</span>{{ person.grunddaten.funktion }}</div>
      </div>
    </section>

    <section class="section bg-white/10 backdrop-blur rounded-lg p-6 shadow-md space-y-2">
      <h2>Kontaktdaten</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="field flex flex-col text-sm"><span>Adresse:</span>{{ person.kontaktdaten.strasse }}</div>
        <div class="field flex flex-col text-sm"><span>PLZ / Ort:</span>{{ person.kontaktdaten.plz }} {{ person.kontaktdaten.ort }}</div>
        <div class="field flex flex-col text-sm"><span>E-Mail:</span>{{ person.kontaktdaten.email }}</div>
        <div class="field flex flex-col text-sm"><span>Telefon Mobil:</span>{{ person.kontaktdaten.telefonMobil }}</div>
      </div>
    </section>

    <!-- Berufliches -->
    <section class="section bg-white/10 backdrop-blur rounded-lg p-6 shadow-md space-y-2">
      <h2>Berufliches</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="field flex flex-col text-sm"><span>Erlernter Beruf:</span>{{ person.berufliches.erlernterBeruf || '—' }}</div>
        <div class="field flex flex-col text-sm"><span>Ausgeübter Beruf:</span>{{ person.berufliches.ausgeubterBeruf || '—' }}</div>
        <div class="field md:col-span-2"><span>Arbeitgeber:</span>{{ person.berufliches.arbeitgeber || '—' }}</div>
        <div class="field md:col-span-2"><span>Zivile Spezialausbildung:</span>{{ person.berufliches.zivileSpezialausbildung || '—' }}</div>
        <div class="field md:col-span-2">
          <span>Führerausweis Kategorien:</span>
          <ng-container *ngIf="person.berufliches['führerausweisKategorie']?.length; else noneFu">
            <span class="chip" *ngFor="let kat of person.berufliches['führerausweisKategorie']">{{ kat }}</span>
          </ng-container>
          <ng-template #noneFu>—</ng-template>
        </div>
      </div>
    </section>

    <!-- Zivilschutz -->
    <section class="section bg-white/10 backdrop-blur rounded-lg p-6 shadow-md space-y-2">
      <h2>Zivilschutz</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="field md:col-span-2"><span>Grundausbildung:</span>{{ person.zivilschutz.grundausbildung || '—' }}</div>
        <div class="field flex flex-col text-sm"><span>Status:</span>{{ person.zivilschutz.status | titlecase }}</div>
        <div class="field flex flex-col text-sm"><span>Zug:</span>{{ person.zivilschutz.einteilung.zug }}</div>
        <div class="field flex flex-col text-sm"><span>Gruppe:</span>{{ person.zivilschutz.einteilung.gruppe }}</div>
        <div class="field md:col-span-2">
          <span>Zusatzausbildungen:</span>
          <ng-container *ngIf="person.zivilschutz.zusatzausbildungen?.length; else noneZu">
            <span class="chip" *ngFor="let zu of person.zivilschutz.zusatzausbildungen">{{ zu }}</span>
          </ng-container>
          <ng-template #noneZu>—</ng-template>
        </div>
      </div>
    </section>

    <!-- Persönliches -->
    <section class="section bg-white/10 backdrop-blur rounded-lg p-6 shadow-md space-y-2">
      <h2>Persönliches</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="field flex flex-col text-sm"><span>Blutgruppe:</span>{{ person.persoenliches.blutgruppe || '—' }}</div>
        <div class="field md:col-span-2">
          <span>Allergien:</span>
          <ng-container *ngIf="person.persoenliches.allergien?.length; else noneAll">
            <span class="chip" *ngFor="let a of person.persoenliches.allergien">{{ a }}</span>
          </ng-container>
          <ng-template #noneAll>—</ng-template>
        </div>
        <div class="field md:col-span-2">
          <span>Essgewohnheiten:</span>
          <ng-container *ngIf="person.persoenliches.essgewohnheiten?.length; else noneEss">
            <span class="chip" *ngFor="let e of person.persoenliches.essgewohnheiten">{{ e }}</span>
          </ng-container>
          <ng-template #noneEss>—</ng-template>
        </div>
        <div class="field md:col-span-2">
          <span>Sprachkenntnisse:</span>
          <ng-container *ngIf="person.persoenliches.sprachkenntnisse?.length; else noneSp">
            <span class="chip" *ngFor="let s of person.persoenliches.sprachkenntnisse">{{ s }}</span>
          </ng-container>
          <ng-template #noneSp>—</ng-template>
        </div>
        <div class="field md:col-span-2">
          <span>Besonderheiten:</span>
          <ng-container *ngIf="person.persoenliches.besonderheiten?.length; else noneBe">
            <span class="chip" *ngFor="let b of person.persoenliches.besonderheiten">{{ b }}</span>
          </ng-container>
          <ng-template #noneBe>—</ng-template>
        </div>
      </div>
    </section>

    </div>
        <!-- Aside Column -->
        <aside class="space-y-4">
          <!-- Notfallkontakte -->
    <section class="section bg-white/10 backdrop-blur rounded-lg p-6 shadow-md space-y-2">
      <h2>Notfallkontakte ({{ notfallkontakte?.length || 0 }})</h2>
      <ng-container *ngIf="notfallkontakte?.length; else noneNk">
        <div class="nk-list divide-y divide-white/10">
          <div class="nk-item flex items-center justify-between py-2" *ngFor="let nk of notfallkontakte">
            <div>
              <h4>{{ nk.name }}</h4>
              <p class="sub">{{ nk.beziehung }}</p>
            </div>
            <div class="nummer">{{ nk.telefonnummer }}</div>
          </div>
        </div>
      </ng-container>
      <ng-template #noneNk><p class="text-gray-400 italic">Keine Notfallkontakte</p></ng-template>
    </section>
        </aside>
      </div>
    </div>
  </ng-container>

  <!-- Modal -->
  <zso-adzs-create-modal
    [visible]="modalVisible"
    [person]="person ?? undefined"
    (closed)="onModalClosed()"
    (created)="onPersonUpdated($event)">
  </zso-adzs-create-modal>
</div>