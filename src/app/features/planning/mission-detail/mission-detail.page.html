<div class="min-h-[calc(100vh-64px)] text-white">
  <div class="layout-container py-6 space-y-6">
    <div class="flex items-center justify-between gap-4">
      <button
        (click)="back()"
        class="inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-gray-800 text-gray-300 hover:bg-gray-700 hover:text-white transition-colors"
      >
        <span class="material-symbols-outlined text-lg">arrow_back</span>
        <span class="text-sm font-medium">Zurück</span>
      </button>

      <div class="flex gap-2">
        <zso-button type="neutral" size="sm" (click)="edit()">
          <span class="material-symbols-outlined text-base mr-1">edit</span>
          Bearbeiten
        </zso-button>
        <zso-button
          type="danger"
          size="sm"
          [loading]="isDeleting"
          (click)="delete()"
        >
          <span class="material-symbols-outlined text-base mr-1">delete</span>
          Löschen
        </zso-button>
      </div>
    </div>

    @if (isLoading) {
    <div class="glass-card p-6 space-y-3">
      <zso-skeleton width="50%" height="1.25rem" />
      <zso-skeleton width="70%" height="0.9rem" className="opacity-70" />
      <zso-skeleton width="60%" height="0.9rem" className="opacity-60" />
    </div>
    } @else { @if (errorMsg) {
    <zso-state-message
      icon="error"
      tone="danger"
      title="Fehler"
      [text]="errorMsg"
    ></zso-state-message>
    } @else {
    <div class="space-y-6">
      <div class="glass-card p-6">
        <div class="flex items-start justify-between gap-4 flex-wrap">
          <div class="min-w-0">
            <h1 class="text-2xl sm:text-3xl font-bold text-white truncate">
              {{ mission!.title }}
            </h1>
            <p class="text-sm text-gray-400 mt-1">
              {{ mission!.startAt | date:'dd.MM.yyyy HH:mm' }}
              <span class="opacity-60">→</span>
              {{ mission!.endAt | date:'dd.MM.yyyy HH:mm' }}
            </p>
          </div>
          <span
            class="text-xs px-2 py-1 rounded border border-white/10 bg-white/5 text-gray-200"
          >
            {{ mission!.status }}
          </span>
        </div>

        @if (mission!.description) {
        <p class="text-sm text-gray-200 mt-4 whitespace-pre-line">
          {{ mission!.description }}
        </p>
        }
      </div>

      <div class="glass-card p-6">
        <h2 class="text-lg font-semibold mb-3">Ort</h2>
        <button
          class="text-left w-full glass-card p-4 hover:bg-white/10 transition-colors rounded-lg"
          (click)="openPlace()"
          [disabled]="!place"
        >
          <div class="flex items-center justify-between gap-4">
            <div class="min-w-0">
              <div class="text-sm font-medium text-white truncate">
                {{ place?.name || '—' }}
              </div>
              <div class="text-xs text-gray-400 truncate">
                {{ place?.address?.street }}, {{ place?.address?.zip }} {{
                place?.address?.city }}
              </div>
            </div>
            <span class="material-symbols-outlined text-gray-400"
              >chevron_right</span
            >
          </div>
        </button>
      </div>

      <div class="glass-card p-6">
        <div class="flex items-center justify-between gap-4">
          <h2 class="text-lg font-semibold">Zuteilung (AdZS)</h2>
          <span class="text-xs text-gray-400"
            >{{ assignedPersons.length }}</span
          >
        </div>

        @if (assignedPersons.length === 0) {
        <p class="text-sm text-gray-400 mt-3">Keine Personen zugeteilt.</p>
        } @else {
        <div class="mt-3 divide-y divide-white/10">
          @for (p of assignedPersons; track p.id) {
          <button
            class="w-full text-left flex items-center justify-between gap-4 p-3 hover:bg-white/5 transition-colors"
            (click)="openPerson(p.id)"
          >
            <div class="min-w-0">
              <div class="text-sm text-white truncate">{{ p.name }}</div>
              <div class="text-xs text-gray-400 truncate">
                {{ p.zug }}. Zug • Gruppe {{ p.gruppe }}
              </div>
            </div>
            <span class="material-symbols-outlined text-gray-400"
              >chevron_right</span
            >
          </button>
          }
        </div>
        }
      </div>
    </div>
    } }
  </div>
</div>
