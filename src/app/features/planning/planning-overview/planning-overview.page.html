<div class="min-h-[calc(100vh-64px)] py-3 sm:py-4 md:py-6 lg:py-8 text-white">
  <div class="layout-container space-y-4 sm:space-y-6">
    <div
      class="glass-card p-4 sm:p-6 flex items-center justify-between gap-4 flex-wrap"
    >
      <div class="space-y-1">
        <h1 class="text-lg sm:text-xl font-semibold">Einsatz</h1>
        <p class="text-xs sm:text-sm text-gray-400">
          Einsätze verwalten und AdZS/Orte zuweisen.
        </p>
      </div>

      <zso-button type="primary" routerLink="/planning/new">
        <span class="material-symbols-outlined text-base mr-1">add</span>
        Neuer Einsatz
      </zso-button>
    </div>

    <div class="glass-card p-4 sm:p-6">
      @let vm = vm$ | async;
      <div class="grid grid-cols-1 md:grid-cols-5 gap-3">
        <div>
          <label class="text-xs text-gray-400">Suche</label>
          <input
            class="form-input mt-1"
            placeholder="Titel…"
            (input)="setSearch(($any($event.target).value))"
          />
        </div>

        <div>
          <label class="text-xs text-gray-400">Status</label>
          <select
            class="form-input sort-select mt-1"
            (change)="setStatus($any($event.target).value)"
          >
            @for (opt of statusOptions; track opt.value) {
            <option [value]="opt.value">{{ opt.label }}</option>
            }
          </select>
        </div>

        <div>
          <label class="text-xs text-gray-400">Ort</label>
          <select
            class="form-input sort-select mt-1"
            (change)="setPlaceId($any($event.target).value)"
          >
            @if (vm?.placeOptions?.length) { @for (opt of vm!.placeOptions;
            track opt.value) {
            <option
              [value]="opt.value"
              [selected]="opt.value === vm!.selectedPlaceId"
            >
              {{ opt.label }}
            </option>
            } } @else {
            <option value="all">Alle Orte</option>
            }
          </select>
        </div>

        <div>
          <label class="text-xs text-gray-400">Datum von</label>
          <input
            class="form-input mt-1"
            type="date"
            [value]="vm?.dateFrom ?? ''"
            (change)="setDateFrom($any($event.target).value)"
          />
        </div>

        <div>
          <label class="text-xs text-gray-400">Datum bis</label>
          <input
            class="form-input mt-1"
            type="date"
            [value]="vm?.dateTo ?? ''"
            (change)="setDateTo($any($event.target).value)"
          />
        </div>
      </div>

      <div class="mt-4 flex items-center justify-between gap-3 flex-wrap">
        <div class="text-xs text-gray-400">
          @if (vm?.total !== null && vm?.total !== undefined) { {{ vm?.total ??
          0 }} Einträge }
        </div>

        <div class="flex items-center gap-2">
          <label class="text-xs text-gray-400">Pro Seite</label>
          <select
            class="form-input sort-select"
            (change)="setPageSize($any($event.target).value)"
          >
            <option value="10">10</option>
            <option value="25" selected>25</option>
            <option value="50">50</option>
          </select>
        </div>
      </div>
    </div>

    @let vm2 = vm$ | async; @if (vm2 === null) {
    <div class="glass-card p-6">
      <div class="space-y-3">
        @for (i of [0,1,2,3,4]; track i) {
        <div class="flex items-center justify-between gap-4 p-3 rounded-lg">
          <div class="flex-1 min-w-0 space-y-2">
            <zso-skeleton width="55%" height="1rem" />
            <zso-skeleton width="75%" height="0.75rem" className="opacity-70" />
          </div>
          <zso-skeleton width="6rem" height="1.5rem" className="opacity-60" />
        </div>
        }
      </div>
    </div>
    } @else { @if (vm2.total === 0) {
    <zso-state-message
      icon="event_busy"
      tone="neutral"
      title="Keine Einsätze"
      text="Es sind noch keine Einsätze vorhanden."
    />
    } @else {
    <div class="glass-card p-4 sm:p-6">
      <div class="space-y-2">
        @for (row of vm2.rows; track trackRow($index, row)) {
        <a
          [routerLink]="['/planning', row.mission.id]"
          class="block glass-card p-4 hover-card cursor-pointer"
        >
          <div class="flex items-start justify-between gap-4">
            <div class="min-w-0">
              <div class="flex items-center gap-2 flex-wrap">
                <h2 class="text-sm sm:text-base font-semibold truncate">
                  {{ row.mission.title }}
                </h2>
                <span
                  class="badge"
                  [ngClass]="statusBadgeClass(row.mission.status)"
                >
                  {{ statusLabel(row.mission.status) }}
                </span>
              </div>

              <p
                class="text-xs sm:text-sm mt-1"
                [ngClass]="row.isOverPlaceCapacity ? 'text-rose-400' : 'text-gray-400'"
              >
                {{ row.placeName }}
                <span class="opacity-60">•</span>
                {{ row.mission.startAt | date:'dd.MM.yyyy HH:mm' }}
                <span class="opacity-60">→</span>
                {{ row.mission.endAt | date:'dd.MM.yyyy HH:mm' }}
                <span class="opacity-60">•</span>
                Verantw.: {{ row.responsibleLabel }}
                <span class="opacity-60">•</span>
                @if (row.placeMaxPersons) { {{ row.assignedPersonsCount }} / {{
                row.placeMaxPersons }} AdZS } @else { {{
                row.assignedPersonsCount }} AdZS }
              </p>
            </div>

            <span class="material-symbols-outlined text-gray-400"
              >chevron_right</span
            >
          </div>
        </a>
        }
      </div>

      <div class="mt-4 flex items-center justify-between gap-3">
        <div class="text-xs text-gray-400">
          Seite {{ vm2.page }} / {{ vm2.totalPages }}
        </div>

        <div class="flex items-center gap-2">
          <button
            type="button"
            class="inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-gray-800 text-gray-300 hover:bg-gray-700 hover:text-white transition-colors text-xs"
            (click)="prevPage()"
            [disabled]="vm2.page <= 1"
          >
            <span class="material-symbols-outlined text-base"
              >chevron_left</span
            >
            Zurück
          </button>

          <button
            type="button"
            class="inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-gray-800 text-gray-300 hover:bg-gray-700 hover:text-white transition-colors text-xs"
            (click)="nextPage()"
            [disabled]="vm2.page >= vm2.totalPages"
          >
            Weiter
            <span class="material-symbols-outlined text-base"
              >chevron_right</span
            >
          </button>
        </div>
      </div>
    </div>
    } }
  </div>
</div>
