<!-- Vollbild-BG + Overlay ---------------------------------------------- -->
<div class="relative min-h-screen bg-fixed bg-cover bg-center
            bg-[url('assets/images/background_mountains.jpg')]">
  <div class="absolute inset-0 bg-[#0e1628]/90"></div>

  <header class="relative z-20 backdrop-blur-lg">
    <nav class="mx-auto max-w-7xl h-16 px-4 sm:px-6 lg:px-8 flex items-center">

      <!-- Logo --------------------------------------------------------- -->
      <a routerLink="/" class="flex items-end gap-1 font-bold text-white">
        <span class="text-xl text-cp-orange">ZSO GANTRISCH</span>
        <span class="text-sm leading-none tracking-tight">base</span>
      </a>

      <!-- Desktop-Links ------------------------------------------------ -->
      <ul class="hidden md:flex gap-6 absolute left-1/2 -translate-x-1/2">
        <li><a routerLink="/dashboard" routerLinkActive="pill-active underline-sweep"
               [routerLinkActiveOptions]="{exact:true}" class="pill">Dashboard</a></li>
        <li *ngIf="isAdmin$ | async">
          <a routerLink="/admin/users" routerLinkActive="pill-active underline-sweep"
             class="pill">Benutzer</a></li>
      </ul>

      <div class="flex-1"></div>

      <!-- Avatar-Button (Overlay-Origin) ------------------------------- -->
      <button cdkOverlayOrigin #origin="cdkOverlayOrigin"
              (click)="toggleProfile()"
              class="avatar group ring-1 ring-transparent hover:ring-cp-orange/60 transition-all"
              aria-haspopup="menu"
              [attr.aria-expanded]="overlayOpen">
        <ng-container *ngIf="appUser$ | async as cur; else initialsOnly">
          <ng-container *ngIf="cur.doc.photoUrl || cur.doc.photoURL; else initials">
            <img [src]="cur.doc.photoUrl || cur.doc.photoURL" alt="Avatar" class="h-9 w-9 rounded-full object-cover" />
          </ng-container>
          <ng-template #initials><span>{{ initials$ | async }}</span></ng-template>
        </ng-container>
        <ng-template #initialsOnly><span>{{ initials$ | async }}</span></ng-template>
        <span class="material-symbols-outlined text-base transition-transform group-hover:text-cp-orange
                     group-[[aria-expanded=true]]:rotate-180">expand_more</span>
      </button>

      <!-- Dropdown (CDK-Overlay) -------------------------------------- -->
      <ng-template
         cdkConnectedOverlay
         [cdkConnectedOverlayOrigin]="origin"
         [cdkConnectedOverlayOpen]="overlayOpen"
         [cdkConnectedOverlayPositions]="positions"
         cdkConnectedOverlayHasBackdrop
         cdkConnectedOverlayBackdropClass="cdk-overlay-transparent-backdrop"
         (backdropClick)="overlayOpen=false"
         (detach)="overlayOpen=false">

        <ul class="dropdown-menu z-50">
          <li><button class="dropdown-item underline-sweep" (click)="myProfile()">Mein Profil</button></li>
          <li><button class="dropdown-item underline-sweep text-rose-600"
                      (click)="logout()">Abmelden</button></li>
        </ul>
      </ng-template>

      <!-- Burger (mobile) --------------------------------------------- -->
      <button class="md:hidden text-gray-300 ml-3"
              (click)="toggleMobile()" aria-label="MenÃ¼">
        <span class="material-symbols-outlined text-3xl">
          {{ showLinks ? 'close' : 'menu' }}
        </span>
      </button>
    </nav>

    <!-- Mobile-Links --------------------------------------------------- -->
    <ul *ngIf="showLinks"
        class="md:hidden bg-[#0e1628]/95 backdrop-blur-sm border-t border-white/5">
      <li><a routerLink="/dashboard" (click)="toggleMobile()" class="mobile-link">Dashboard</a></li>
      <li *ngIf="isAdmin$ | async">
        <a routerLink="/admin/users" (click)="toggleMobile()" class="mobile-link">Benutzer</a></li>
      <li><button (click)="logout()" class="mobile-link text-rose-400">Abmelden</button></li>
    </ul>
  </header>

  <main class="relative z-10 flex-1">
    <router-outlet></router-outlet>
  </main>
</div>
